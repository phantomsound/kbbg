<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Listen Live — KBBG FM 88.1</title>
  <meta name="description" content="Listen live to KBBG FM 88.1." />
  <meta name="theme-color" content="#4B0082" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="site-header">
  <a class="logo" href="./">KBBG 88.1</a>
  <nav class="nav">
    <a href="./">Home</a>
    <a class="btn btn-gold" href="listen.html" aria-current="page">Listen</a>
  </nav>
</header>

<main>
  <section class="listen-hero">
    <h1>KBBG FM 88.1 — Listen Live</h1>
    <p>Press play. If playback fails, try the app below.</p>
  </section>

  <section class="player-wrap" aria-label="KBBG 88.1 Live Stream">
    <!-- Real Radio.co stream -->
    <audio id="player" controls preload="none">
      <source src="https://s5.radio.co/se50df870e/listen" type="audio/mpeg">
      <!-- Optional HLS secondary source -->
      <source src="https://s5.radio.co/se50df870e/listen.m3u8" type="application/vnd.apple.mpegurl">
      Your browser does not support the audio element.
    </audio>

    <div class="player-actions">
      <a class="btn btn-gold" href="#" onclick="document.getElementById('player').play();return false;">Play</a>
      <a class="btn" href="#" onclick="document.getElementById('player').pause();return false;">Pause</a>
    </div>

    <p class="note">
      Tip: Autoplay is blocked by browsers—tap Play to start. If playback stalls, try the app links below.
    </p>
  </section>

  <section class="app-cta">
    <h2>Prefer the app?</h2>
    <div class="store-row">
      <a class="store-badge" target="_blank" rel="noopener"
         href="https://play.google.com/store/apps/details?id=com.AppInstitute.kbbgfm88">Get it on Google Play</a>
      <a class="store-badge" id="iosStoreListen" target="_blank" rel="noopener"
         href="IOS_APP_STORE_URL">Download on the App Store</a>
    </div>
    <div class="dual-cta">
      <a class="btn btn-gold btn-lg" id="smartAppBtn" href="#">Open the App</a>
    </div>
  </section>

  <!-- If you find HLS is required on desktop Chrome, you can enable hls.js below.
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script>
    (function(){
      const audio = document.getElementById('player');
      const hlsUrl = 'https://s5.radio.co/se50df870e/listen.m3u8';
      if (hlsUrl.endsWith('.m3u8')) {
        if (audio.canPlayType('application/vnd.apple.mpegurl')) {
          audio.src = hlsUrl;
        } else if (window.Hls && Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(hlsUrl);
          hls.attachMedia(audio);
        }
      }
    })();
  </script>
  -->
</main>

<footer class="site-footer">
  <p>© <span id="y"></span> KBBG FM 88.1 · <a href="./">Home</a></p>
</footer>

<script>
  document.getElementById('y').textContent = new Date().getFullYear();

  // Smart "Open the App" button — routes users to the right store
  (function(){
    const ANDROID = /Android/i.test(navigator.userAgent);
    const IOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    const links = {
      android: 'https://play.google.com/store/apps/details?id=com.AppInstitute.kbbgfm88',
      ios: 'IOS_APP_STORE_URL' // TODO: replace with your real App Store URL
    };
    const smart = document.getElementById('smartAppBtn');

    if (ANDROID) {
      smart.href = links.android;
      smart.setAttribute('target','_blank'); smart.setAttribute('rel','noopener');
    } else if (IOS) {
      smart.href = links.ios;
      smart.setAttribute('target','_blank'); smart.setAttribute('rel','noopener');
      if (!links.ios || links.ios === 'IOS_APP_STORE_URL') {
        smart.textContent = 'App Store link coming soon';
        smart.classList.add('btn-disabled');
        smart.href = '#';
        smart.addEventListener('click', e => e.preventDefault());
        const iosBadge = document.getElementById('iosStoreListen');
        if (iosBadge) {
          iosBadge.classList.add('disabled');
          iosBadge.title = 'iOS link coming soon';
          iosBadge.href = '#';
        }
      }
    } else {
      smart.href = 'https://phantomsound.github.io/kbbg/listen.html';
    }
  })();
</script>
</body>
</html>
